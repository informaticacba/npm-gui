{"id":"TjZG","dependencies":[{"name":"/home/pst/workspace/npm-gui/tsconfig.json","includedInParent":true,"mtime":1614887755913},{"name":"/home/pst/workspace/npm-gui/package.json","includedInParent":true,"mtime":1615239438480},{"name":"axios","loc":{"line":54,"column":38},"parent":"/home/pst/workspace/npm-gui/client/components/Dependencies/hooks/useDependencies.ts","resolved":"/home/pst/workspace/npm-gui/node_modules/axios/index.js"},{"name":"react","loc":{"line":55,"column":22},"parent":"/home/pst/workspace/npm-gui/client/components/Dependencies/hooks/useDependencies.ts","resolved":"/home/pst/workspace/npm-gui/node_modules/react/index.js"},{"name":"../../Schedule/ScheduleContext","loc":{"line":56,"column":32},"parent":"/home/pst/workspace/npm-gui/client/components/Dependencies/hooks/useDependencies.ts","resolved":"/home/pst/workspace/npm-gui/client/components/Schedule/ScheduleContext.ts"},{"name":"../../../app/StoreContext","loc":{"line":57,"column":29},"parent":"/home/pst/workspace/npm-gui/client/components/Dependencies/hooks/useDependencies.ts","resolved":"/home/pst/workspace/npm-gui/client/app/StoreContext.ts"},{"name":"../../../utils","loc":{"line":58,"column":22},"parent":"/home/pst/workspace/npm-gui/client/components/Dependencies/hooks/useDependencies.ts","resolved":"/home/pst/workspace/npm-gui/client/utils.ts"}],"generated":{"js":"\"use strict\";var e=this&&this.__assign||function(){return(e=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},t=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(i,u){function o(e){try{c(r.next(e))}catch(t){u(t)}}function a(e){try{c(r.throw(e))}catch(t){u(t)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(o,a)}c((r=r.apply(e,t||[])).next())})},n=this&&this.__generator||function(e,t){var n,r,i,u,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return u={next:a(0),throw:a(1),return:a(2)},\"function\"==typeof Symbol&&(u[Symbol.iterator]=function(){return this}),u;function a(u){return function(a){return function(u){if(n)throw new TypeError(\"Generator is already executing.\");for(;o;)try{if(n=1,r&&(i=2&u[0]?r.return:u[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,u[1])).done)return i;switch(r=0,i&&(u=[2&u[0],i.value]),u[0]){case 0:case 1:i=u;break;case 4:return o.label++,{value:u[1],done:!1};case 5:o.label++,r=u[1],u=[0];continue;case 7:u=o.ops.pop(),o.trys.pop();continue;default:if(!(i=(i=o.trys).length>0&&i[i.length-1])&&(6===u[0]||2===u[0])){o=0;continue}if(3===u[0]&&(!i||u[1]>i[0]&&u[1]<i[3])){o.label=u[1];break}if(6===u[0]&&o.label<i[1]){o.label=i[1],i=u;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(u);break}i[2]&&o.ops.pop(),o.trys.pop();continue}u=t.call(e,o)}catch(a){u=[6,a],r=0}finally{n=i=0}if(5&u[0])throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}([u,a])}}},r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,\"__esModule\",{value:!0}),exports.useDependencies=void 0;var i=r(require(\"axios\")),u=require(\"react\"),o=require(\"../../Schedule/ScheduleContext\"),a=require(\"../../../app/StoreContext\"),c=require(\"../../../utils\");function s(e){return\"global\"!==e?\"/api/project/\"+e+\"/dependencies\":\"api/global/dependencies\"}function l(r){var l=this,f=u.useContext(o.ScheduleContext).addToApiSchedule,d=u.useContext(a.StoreContext),p=d.projects,h=d.setProjectDependencies,v=u.useState({}),b=v[0],y=v[1],g=u.useCallback(function(t,n){var r=t.reduce(function(t,r){var i;return e(e({},t),((i={})[r.name]=n,i))},{});y(r)},[]),m=p[r],x=u.useMemo(function(){return m?m.dependencies:[]},[m]),w=u.useCallback(function(){f({projectPath:r,description:\"fetching dependencies\",executeMe:function(){return t(l,void 0,void 0,function(){var e,t;return n(this,function(n){switch(n.label){case 0:return[4,i.default.get(s(r)+\"/simple\")];case 1:return e=n.sent(),h(r,e.data),g(e.data,!0),[4,i.default.get(s(r)+\"/full\")];case 2:return t=n.sent(),h(r,t.data),g(e.data,!1),[2]}})})}})},[h,f,g,r]),C=u.useCallback(function(e,u){var o;y(((o={})[e.name]=!0,o)),f({projectPath:r,description:\"installing \"+e.name+\" as \"+u,executeMe:function(){return t(l,void 0,void 0,function(){var t,o;return n(this,function(n){switch(n.label){case 0:return y(((t={})[e.name]=!0,t)),[4,i.default.post(s(r)+\"/\"+u,[e])];case 1:return n.sent(),y(((o={})[e.name]=!1,o)),w(),[2]}})})}})},[f,w,r]),_=u.useCallback(function(e){var u;y(((u={})[e.name]=!0,u)),f({projectPath:r,description:\"deleting \"+e.name+\" as \"+e.type,executeMe:function(){return t(l,void 0,void 0,function(){var t,u;return n(this,function(n){switch(n.label){case 0:return y(((t={})[e.name]=!0,t)),[4,i.default.delete(s(r)+\"/\"+e.type+\"/\"+e.name)];case 1:return n.sent(),y(((u={})[e.name]=!1,u)),w(),[2]}})})}})},[f,r,w]),j=u.useCallback(function(e){x&&(g(x,!0),f({projectPath:r,description:(!0===e?\"force\":\"\")+\" installing all\",executeMe:function(){return t(l,void 0,void 0,function(){return n(this,function(t){switch(t.label){case 0:return g(x,!0),[4,i.default.post(s(r)+\"/install\"+(!0===e?\"/force\":\"\"))];case 1:return t.sent(),g(x,!0),w(),[2]}})})}}))},[f,r,x,w,g]),k=u.useCallback(function(e){if(x){var u=x.filter(function(t){return\"string\"==typeof t[e]&&t[e]!==c.getNormalizedRequiredVersion(t.required)}).map(function(t){return{name:t.name,version:t[e],type:t.type}});if(u.length!==c.ZERO){g(u,!0);var o=u.filter(function(e){return\"dev\"===e.type}),a=u.filter(function(e){return\"prod\"===e.type});f({projectPath:r,description:\"updating dependencies to \"+e,executeMe:function(){return t(l,void 0,void 0,function(){return n(this,function(e){switch(e.label){case 0:return g(u,!0),[4,i.default.post(s(r)+\"/dev\",o)];case 1:return e.sent(),[4,i.default.post(s(r)+\"/prod\",a)];case 2:return e.sent(),g(u,!0),w(),[2]}})})}})}}},[f,g,r,x,w]);return u.useEffect(function(){w()},[w]),{dependencies:x,dependenciesProcessing:b,onInstallNewDependency:C,onInstallAllDependencies:j,onDeleteDependency:_,onUpdateDependencies:k}}exports.useDependencies=l;"},"sourceMaps":null,"error":null,"hash":"5de7b7208a346692c6906d2979f6b336","cacheData":{"env":{}}}